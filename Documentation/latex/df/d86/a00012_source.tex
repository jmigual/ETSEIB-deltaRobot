\hypertarget{a00012_source}{}\section{dynamixel.\+cpp}
\label{a00012_source}\index{dxl/dynamixel.\+cpp@{dxl/dynamixel.\+cpp}}

\begin{DoxyCode}
00001 
00004 \textcolor{preprocessor}{#include "\hyperlink{a00013}{dynamixel.h}"}
00005 
00006 \textcolor{preprocessor}{#define LATENCY\_TIME        (16) //ms (USB2Dynamixel Default Latency Time)}
00007 \textcolor{preprocessor}{#define PING\_STATUS\_LENGTH  (14)}
00008 
00009 
\hypertarget{a00012_source_l00010}{}\hyperlink{a00003_a5d4fed957a4b2d1690c0fa72127f5cbf}{00010} \hyperlink{a00003_a7aa668a213db6a41bede8e08a6fec830}{dynamixel::dynamixel}(QString port\_num, \textcolor{keywordtype}{int} baud\_rate)
00011 \{
00012     \hyperlink{a00003_a87960244d5846ae7583e37d2407eb61e}{initialize}(port\_num, baud\_rate);
00013 \}
00014 
\hypertarget{a00012_source_l00015}{}\hyperlink{a00003_a87960244d5846ae7583e37d2407eb61e}{00015} \textcolor{keywordtype}{int} \hyperlink{a00003_a87960244d5846ae7583e37d2407eb61e}{dynamixel::initialize}( QString port\_num, \textcolor{keywordtype}{int} baud\_rate )
00016 \{
00017     \textcolor{keywordflow}{if}( baud\_rate < 1900 ) \textcolor{keywordflow}{return} 0;
00018 
00019     \textcolor{keywordflow}{if}( not \hyperlink{a00003_ae003cc90ada6d7b70eaa4ea9d42d4deb}{dH}.\hyperlink{a00002_ab631c2a5533125f14db9a8ec1c33aa7c}{open}(port\_num, baud\_rate) ) \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00020     
00021     \textcolor{comment}{// 1000/baudrate(bit per msec) * 10(start bit + data bit + stop bit)}
00022     \hyperlink{a00003_a2173f25c6299da7ddb37ba3d2bf1f738}{gdByteTransTime} = 1000.0 / (double)baud\_rate * 10.0; 
00023 
00024     \hyperlink{a00003_a5b603f6bed7ccc595f1f50bd6a6ebbfc}{gbCommStatus} = COMM\_RXSUCCESS;
00025     \hyperlink{a00003_ad10e0e49f5fef04bf789a89c14cc470a}{giBusUsing} = 0;
00026 
00027     \textcolor{keywordflow}{return} \textcolor{keyword}{true};
00028 \}
00029 
\hypertarget{a00012_source_l00030}{}\hyperlink{a00003_a7554c7889896e29e11a62027d89f3fdf}{00030} \textcolor{keywordtype}{int} \hyperlink{a00003_a7554c7889896e29e11a62027d89f3fdf}{dynamixel::change\_baudrate}(\textcolor{keywordtype}{int} baud\_rate )
00031 \{
00032     \textcolor{keywordtype}{int} result = 0;
00033     \textcolor{keywordtype}{float} baudrate = (float)baud\_rate;
00034     
00035     result = \hyperlink{a00003_ae003cc90ada6d7b70eaa4ea9d42d4deb}{dH}.\hyperlink{a00002_a0eaaa5340bc9dce73cc920dc8befe5b0}{change\_baudrate}(baudrate);
00036     \textcolor{keywordflow}{if}(result == 1)
00037         \hyperlink{a00003_a2173f25c6299da7ddb37ba3d2bf1f738}{gdByteTransTime} = 1000.0f / baudrate * 10.0; \textcolor{comment}{// 1000/baudrate(bit per msec) *
       10(start bit + data bit + stop bit)}
00038 
00039     \textcolor{keywordflow}{return} result;
00040 \}
00041 
\hypertarget{a00012_source_l00042}{}\hyperlink{a00003_a92ea074ed1c1a9cf29e039f8c425f01a}{00042} \textcolor{keywordtype}{int} \hyperlink{a00003_a92ea074ed1c1a9cf29e039f8c425f01a}{dynamixel::terminate}(\textcolor{keywordtype}{void})
00043 \{
00044     \hyperlink{a00003_ae003cc90ada6d7b70eaa4ea9d42d4deb}{dH}.\hyperlink{a00002_a250fd7e4acabf54d0733551a13e89a2d}{close}();
00045     \textcolor{keywordflow}{return} 0;
00046 \}
00047 
\hypertarget{a00012_source_l00049}{}\hyperlink{a00003_a2fa5375537184c279a9ebfcfc0425071}{00049} \textcolor{keywordtype}{double} \hyperlink{a00003_a2fa5375537184c279a9ebfcfc0425071}{dynamixel::get\_packet\_time}(\textcolor{keywordtype}{void})
00050 \{
00051     \textcolor{keywordtype}{double} elapsed\_time;
00052 
00053     elapsed\_time = (double)(\hyperlink{a00003_ae003cc90ada6d7b70eaa4ea9d42d4deb}{dH}.\hyperlink{a00002_a6b6b7381c45308662fc3df6e7f74bc61}{get\_curr\_time}() - 
      \hyperlink{a00003_a6c6314fb7070e6fd361e57c5de17e0ec}{gdPacketStartTime});
00054 
00055     \textcolor{comment}{// Overflow}
00056     \textcolor{keywordflow}{if}(elapsed\_time < 0) \hyperlink{a00003_a6c6314fb7070e6fd361e57c5de17e0ec}{gdPacketStartTime} = \hyperlink{a00003_ae003cc90ada6d7b70eaa4ea9d42d4deb}{dH}.\hyperlink{a00002_a6b6b7381c45308662fc3df6e7f74bc61}{get\_curr\_time}();
00057     
00058     \textcolor{keywordflow}{return} elapsed\_time;
00059 \}
00060 
\hypertarget{a00012_source_l00061}{}\hyperlink{a00003_a067f82c21ed176e18fa224d16f3d1c5b}{00061} \textcolor{keywordtype}{void} \hyperlink{a00003_a067f82c21ed176e18fa224d16f3d1c5b}{dynamixel::set\_packet\_timeout}(\textcolor{keywordtype}{int} NumRcvByte)
00062 \{
00063     \hyperlink{a00003_a6c6314fb7070e6fd361e57c5de17e0ec}{gdPacketStartTime} = \hyperlink{a00003_ae003cc90ada6d7b70eaa4ea9d42d4deb}{dH}.\hyperlink{a00002_a6b6b7381c45308662fc3df6e7f74bc61}{get\_curr\_time}();
00064     \hyperlink{a00003_a9f47887864517d74955a2bc787ae4456}{gdRcvWaitTime} = (\hyperlink{a00003_a2173f25c6299da7ddb37ba3d2bf1f738}{gdByteTransTime}*(double)NumRcvByte + 2.0*LATENCY\_TIME + 2.
      0);
00065 \}
00066 
\hypertarget{a00012_source_l00067}{}\hyperlink{a00003_a125b42f776c4aac520f274074f68b591}{00067} \textcolor{keywordtype}{void} \hyperlink{a00003_a125b42f776c4aac520f274074f68b591}{dynamixel::set\_packet\_timeout\_ms}(\textcolor{keywordtype}{int} msec)
00068 \{
00069     \hyperlink{a00003_a6c6314fb7070e6fd361e57c5de17e0ec}{gdPacketStartTime} = \hyperlink{a00003_ae003cc90ada6d7b70eaa4ea9d42d4deb}{dH}.\hyperlink{a00002_a6b6b7381c45308662fc3df6e7f74bc61}{get\_curr\_time}();
00070     \hyperlink{a00003_a9f47887864517d74955a2bc787ae4456}{gdRcvWaitTime} = (double)msec;
00071 \}
00072 
\hypertarget{a00012_source_l00073}{}\hyperlink{a00003_a00d08481ebc4dee19debecf43f888522}{00073} \textcolor{keywordtype}{bool} \hyperlink{a00003_a00d08481ebc4dee19debecf43f888522}{dynamixel::is\_packet\_timeout}(\textcolor{keywordtype}{void})
00074 \{
00075     \textcolor{keywordflow}{if}(this->\hyperlink{a00003_a2fa5375537184c279a9ebfcfc0425071}{get\_packet\_time}() > \hyperlink{a00003_a9f47887864517d74955a2bc787ae4456}{gdRcvWaitTime})
00076         \textcolor{keywordflow}{return} \textcolor{keyword}{true};
00077     \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00078 \}
00079 
\hypertarget{a00012_source_l00081}{}\hyperlink{a00003_a479187cd8940c16dd4374eb5be22b888}{00081} \textcolor{keywordtype}{void} \hyperlink{a00003_a479187cd8940c16dd4374eb5be22b888}{dynamixel::tx\_packet}(\textcolor{keywordtype}{void})
00082 \{
00083     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} pkt\_idx = 0;
00084     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} TxNumByte, RealTxNumByte;
00085     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} checksum = 0;
00086 
00087     \textcolor{keywordflow}{if}( \hyperlink{a00003_ad10e0e49f5fef04bf789a89c14cc470a}{giBusUsing} == 1 )
00088     \{
00089         \hyperlink{a00003_a5b603f6bed7ccc595f1f50bd6a6ebbfc}{gbCommStatus} = COMM\_TXFAIL;
00090         \textcolor{keywordflow}{return};
00091     \}
00092     
00093     \hyperlink{a00003_ad10e0e49f5fef04bf789a89c14cc470a}{giBusUsing} = 1;
00094     
00095     \textcolor{keywordflow}{if}( \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_INSTRUCTION] != INST\_PING
00096         && \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_INSTRUCTION] != INST\_READ
00097         && \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_INSTRUCTION] != INST\_WRITE
00098         && \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_INSTRUCTION] != INST\_REG\_WRITE
00099         && \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_INSTRUCTION] != INST\_ACTION
00100         && \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_INSTRUCTION] != INST\_RESET
00101         && \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_INSTRUCTION] != INST\_SYNC\_WRITE )
00102     \{
00103         \hyperlink{a00003_a5b603f6bed7ccc595f1f50bd6a6ebbfc}{gbCommStatus} = COMM\_TXERROR;
00104         \hyperlink{a00003_ad10e0e49f5fef04bf789a89c14cc470a}{giBusUsing} = 0;
00105         \textcolor{keywordflow}{return};
00106     \}
00107     
00108     \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[0] = 0xff;
00109     \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[1] = 0xff;
00110     \textcolor{keywordflow}{for}( pkt\_idx = 0; pkt\_idx < (\hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_LENGTH]+1); pkt\_idx++ )
00111         checksum += \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[pkt\_idx+2];
00112     \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[\hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_LENGTH]+3] = ~
      checksum;
00113     
00114     \textcolor{comment}{//if( gbCommStatus == COMM\_RXTIMEOUT || gbCommStatus == COMM\_RXCORRUPT )}
00115     \textcolor{comment}{//  dH.clear();}
00116 
00117     \hyperlink{a00003_ae003cc90ada6d7b70eaa4ea9d42d4deb}{dH}.\hyperlink{a00002_a004eedde5af69219d7288ec8ea97c89f}{clear}();
00118 
00119     TxNumByte = gbInstructionPacket[PRT1\_PKT\_LENGTH] + 4;
00120     RealTxNumByte = \hyperlink{a00003_ae003cc90ada6d7b70eaa4ea9d42d4deb}{dH}.\hyperlink{a00002_a90106970438fb0ab65852730a1c0776a}{write}( gbInstructionPacket, TxNumByte );
00121 
00122     \textcolor{keywordflow}{if}( TxNumByte != RealTxNumByte )
00123     \{
00124         \hyperlink{a00003_a5b603f6bed7ccc595f1f50bd6a6ebbfc}{gbCommStatus} = COMM\_TXFAIL;
00125         \hyperlink{a00003_ad10e0e49f5fef04bf789a89c14cc470a}{giBusUsing} = 0;
00126         \textcolor{keywordflow}{return};
00127     \}
00128 
00129     \textcolor{keywordflow}{if}( gbInstructionPacket[PRT1\_PKT\_INSTRUCTION] == INST\_READ )
00130     \{
00131         \hyperlink{a00003_a333686e1b5903d16c41df8172b6bd5a8}{gbRxPacketLength} =  gbInstructionPacket[PRT1\_PKT\_PARAMETER0+1] + 6;
00132         \hyperlink{a00003_a067f82c21ed176e18fa224d16f3d1c5b}{set\_packet\_timeout}( gbInstructionPacket[PRT1\_PKT\_PARAMETER0+1] + 6 );
00133     \}
00134     \textcolor{keywordflow}{else}
00135     \{
00136         \hyperlink{a00003_a333686e1b5903d16c41df8172b6bd5a8}{gbRxPacketLength} = 6;
00137         \hyperlink{a00003_a067f82c21ed176e18fa224d16f3d1c5b}{set\_packet\_timeout}( 6 );
00138     \}
00139 
00140     \hyperlink{a00003_a5b603f6bed7ccc595f1f50bd6a6ebbfc}{gbCommStatus} = COMM\_TXSUCCESS;
00141 \}
00142 
\hypertarget{a00012_source_l00143}{}\hyperlink{a00003_aa26d2d2dff768563a1cb1480aa061608}{00143} \textcolor{keywordtype}{void} \hyperlink{a00003_aa26d2d2dff768563a1cb1480aa061608}{dynamixel::rx\_packet}(\textcolor{keywordtype}{void})
00144 \{
00145     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} i = 0, j = 0, nRead = 0;
00146     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} checksum = 0;
00147 
00148     \textcolor{keywordflow}{if}( \hyperlink{a00003_ad10e0e49f5fef04bf789a89c14cc470a}{giBusUsing} == 0 )
00149         \textcolor{keywordflow}{return};
00150 
00151     \textcolor{keywordflow}{if}( \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_ID] == BROADCAST\_ID )
00152     \{
00153         \hyperlink{a00003_a5b603f6bed7ccc595f1f50bd6a6ebbfc}{gbCommStatus} = COMM\_RXSUCCESS;
00154         \hyperlink{a00003_ad10e0e49f5fef04bf789a89c14cc470a}{giBusUsing} = 0;
00155         \textcolor{keywordflow}{return};
00156     \}
00157     
00158     \textcolor{keywordflow}{if}( \hyperlink{a00003_a5b603f6bed7ccc595f1f50bd6a6ebbfc}{gbCommStatus} == COMM\_TXSUCCESS )
00159     \{
00160         \hyperlink{a00003_a9d590ce24791d111c2db9b66be1e046d}{gbRxGetLength} = 0;
00161         \textcolor{comment}{//gbRxPacketLength = 6; //minimum wait length}
00162     \}
00163     
00164     \textcolor{keywordflow}{while}(1)
00165     \{
00166         nRead = \hyperlink{a00003_ae003cc90ada6d7b70eaa4ea9d42d4deb}{dH}.\hyperlink{a00002_ac36331febb2eaa66303af3483795742a}{read}( &\hyperlink{a00003_aa57c86d3bbbeaf5c9d4f6bd00376b04f}{gbStatusPacket}[\hyperlink{a00003_a9d590ce24791d111c2db9b66be1e046d}{gbRxGetLength}], 
      \hyperlink{a00003_a333686e1b5903d16c41df8172b6bd5a8}{gbRxPacketLength} - gbRxGetLength );
00167         gbRxGetLength += nRead;
00168 
00169         \textcolor{keywordflow}{if}(gbRxGetLength > 4)
00170             \hyperlink{a00003_a333686e1b5903d16c41df8172b6bd5a8}{gbRxPacketLength} = \hyperlink{a00003_aa57c86d3bbbeaf5c9d4f6bd00376b04f}{gbStatusPacket}[PRT1\_PKT\_LENGTH] + 4;
00171 
00172         \textcolor{keywordflow}{if}( gbRxGetLength < \hyperlink{a00003_a333686e1b5903d16c41df8172b6bd5a8}{gbRxPacketLength} )
00173         \{
00174             \textcolor{keywordflow}{if}( \hyperlink{a00003_a00d08481ebc4dee19debecf43f888522}{is\_packet\_timeout}() == 1 )
00175             \{
00176                 \textcolor{keywordflow}{if}(gbRxGetLength == 0)
00177                     \hyperlink{a00003_a5b603f6bed7ccc595f1f50bd6a6ebbfc}{gbCommStatus} = COMM\_RXTIMEOUT;
00178                 \textcolor{keywordflow}{else}
00179                     \hyperlink{a00003_a5b603f6bed7ccc595f1f50bd6a6ebbfc}{gbCommStatus} = COMM\_RXCORRUPT;
00180                 \hyperlink{a00003_ad10e0e49f5fef04bf789a89c14cc470a}{giBusUsing} = 0;
00181                 \textcolor{keywordflow}{return};
00182             \}
00183             \hyperlink{a00003_a5b603f6bed7ccc595f1f50bd6a6ebbfc}{gbCommStatus} = COMM\_RXWAITING;
00184             \textcolor{comment}{//return;           }
00185         \}
00186         \textcolor{keywordflow}{else}
00187         \{
00188             \textcolor{keywordflow}{break};
00189         \}
00190     \}
00191 
00192     \textcolor{comment}{// Find packet header}
00193     \textcolor{keywordflow}{for}( i=0; i<(\hyperlink{a00003_a9d590ce24791d111c2db9b66be1e046d}{gbRxGetLength}-1); i++ )
00194     \{
00195         \textcolor{keywordflow}{if}( \hyperlink{a00003_aa57c86d3bbbeaf5c9d4f6bd00376b04f}{gbStatusPacket}[i] == 0xff && \hyperlink{a00003_aa57c86d3bbbeaf5c9d4f6bd00376b04f}{gbStatusPacket}[i+1] == 0xff )
00196             \textcolor{keywordflow}{break};
00197         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( i == \hyperlink{a00003_a9d590ce24791d111c2db9b66be1e046d}{gbRxGetLength}-2 && \hyperlink{a00003_aa57c86d3bbbeaf5c9d4f6bd00376b04f}{gbStatusPacket}[
      \hyperlink{a00003_a9d590ce24791d111c2db9b66be1e046d}{gbRxGetLength}-1] == 0xff )
00198             \textcolor{keywordflow}{break};
00199         \textcolor{keywordflow}{else} \{
00200             \hyperlink{a00003_a5b603f6bed7ccc595f1f50bd6a6ebbfc}{gbCommStatus} = COMM\_RXCORRUPT;
00201             \textcolor{keywordflow}{return};
00202         \}
00203     \}
00204 
00205     \textcolor{keywordflow}{if}( i > 0 )
00206     \{
00207         \textcolor{keywordflow}{for}( j=0; j<(\hyperlink{a00003_a9d590ce24791d111c2db9b66be1e046d}{gbRxGetLength}-i); j++ )
00208             \hyperlink{a00003_aa57c86d3bbbeaf5c9d4f6bd00376b04f}{gbStatusPacket}[j] = \hyperlink{a00003_aa57c86d3bbbeaf5c9d4f6bd00376b04f}{gbStatusPacket}[j + i];
00209             
00210         \hyperlink{a00003_a9d590ce24791d111c2db9b66be1e046d}{gbRxGetLength} -= i;        
00211     \}
00212 
00213     \textcolor{comment}{// Check id pairing}
00214     \textcolor{keywordflow}{if}( \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_ID] != \hyperlink{a00003_aa57c86d3bbbeaf5c9d4f6bd00376b04f}{gbStatusPacket}[PRT1\_PKT\_ID])
00215     \{
00216         \hyperlink{a00003_a5b603f6bed7ccc595f1f50bd6a6ebbfc}{gbCommStatus} = COMM\_RXCORRUPT;
00217         \hyperlink{a00003_ad10e0e49f5fef04bf789a89c14cc470a}{giBusUsing} = 0;
00218         \textcolor{keywordflow}{return};
00219     \}
00220     
00221     \textcolor{comment}{// Check checksum}
00222     \textcolor{keywordflow}{for}( i=0; i<(\hyperlink{a00003_aa57c86d3bbbeaf5c9d4f6bd00376b04f}{gbStatusPacket}[PRT1\_PKT\_LENGTH]+1); i++ )
00223         checksum += \hyperlink{a00003_aa57c86d3bbbeaf5c9d4f6bd00376b04f}{gbStatusPacket}[i+2];
00224     checksum = ~checksum;
00225 
00226     \textcolor{keywordflow}{if}( \hyperlink{a00003_aa57c86d3bbbeaf5c9d4f6bd00376b04f}{gbStatusPacket}[\hyperlink{a00003_aa57c86d3bbbeaf5c9d4f6bd00376b04f}{gbStatusPacket}[PRT1\_PKT\_LENGTH]+3] != checksum )
00227     \{
00228         \hyperlink{a00003_a5b603f6bed7ccc595f1f50bd6a6ebbfc}{gbCommStatus} = COMM\_RXCORRUPT;
00229         \hyperlink{a00003_ad10e0e49f5fef04bf789a89c14cc470a}{giBusUsing} = 0;
00230         \textcolor{keywordflow}{return};
00231     \}
00232     
00233     \hyperlink{a00003_a5b603f6bed7ccc595f1f50bd6a6ebbfc}{gbCommStatus} = COMM\_RXSUCCESS;
00234     \hyperlink{a00003_ad10e0e49f5fef04bf789a89c14cc470a}{giBusUsing} = 0;
00235 \}
00236 
\hypertarget{a00012_source_l00237}{}\hyperlink{a00003_aebfc569c6b1eb0b98f8c385f0f921fc0}{00237} \textcolor{keywordtype}{void} \hyperlink{a00003_aebfc569c6b1eb0b98f8c385f0f921fc0}{dynamixel::txrx\_packet}(\textcolor{keywordtype}{void})
00238 \{
00239     \hyperlink{a00003_a479187cd8940c16dd4374eb5be22b888}{tx\_packet}();
00240 
00241     \textcolor{keywordflow}{if}( \hyperlink{a00003_a5b603f6bed7ccc595f1f50bd6a6ebbfc}{gbCommStatus} != COMM\_TXSUCCESS )
00242         \textcolor{keywordflow}{return}; 
00243     
00244     
00245     \hyperlink{a00003_aa26d2d2dff768563a1cb1480aa061608}{rx\_packet}();
00246 \}
00247 
\hypertarget{a00012_source_l00249}{}\hyperlink{a00003_a84e24c72c3e5be866f8b28c2e5bd1d95}{00249} \textcolor{keywordtype}{void} \hyperlink{a00003_a84e24c72c3e5be866f8b28c2e5bd1d95}{dynamixel::set\_txpacket\_id}(\textcolor{keywordtype}{int} \textcolor{keywordtype}{id})
00250 \{
00251     \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_ID] = (\textcolor{keywordtype}{unsigned} char)\textcolor{keywordtype}{id};
00252 \}
00253 
\hypertarget{a00012_source_l00254}{}\hyperlink{a00003_a209a43f983f214323b6f0a627d5e8c13}{00254} \textcolor{keywordtype}{void} \hyperlink{a00003_a209a43f983f214323b6f0a627d5e8c13}{dynamixel::set\_txpacket\_instruction}(\textcolor{keywordtype}{int} instruction)
00255 \{
00256     \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_INSTRUCTION] = (\textcolor{keywordtype}{unsigned} char)instruction;
00257 \}
00258 
\hypertarget{a00012_source_l00259}{}\hyperlink{a00003_a2c3d31bbbed70a69918e9972a620384b}{00259} \textcolor{keywordtype}{void} \hyperlink{a00003_a2c3d31bbbed70a69918e9972a620384b}{dynamixel::set\_txpacket\_parameter}(\textcolor{keywordtype}{int} index, \textcolor{keywordtype}{int} value)
00260 \{
00261     \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_PARAMETER0+index] = (\textcolor{keywordtype}{unsigned} char)value;
00262 
00263 \}
00264 
\hypertarget{a00012_source_l00265}{}\hyperlink{a00003_a829278f48e21c810b172eb8cab3b86de}{00265} \textcolor{keywordtype}{void} \hyperlink{a00003_a829278f48e21c810b172eb8cab3b86de}{dynamixel::set\_txpacket\_length}(\textcolor{keywordtype}{int} length)
00266 \{
00267     \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_LENGTH] = (\textcolor{keywordtype}{unsigned} char)length;
00268 \}
00269 
\hypertarget{a00012_source_l00270}{}\hyperlink{a00003_a843b0aac721e4264e7e3097f80980243}{00270} \textcolor{keywordtype}{bool}  \hyperlink{a00003_a843b0aac721e4264e7e3097f80980243}{dynamixel::get\_rxpacket\_error}(\textcolor{keywordtype}{int} error)
00271 \{
00272     \textcolor{keywordflow}{if}( \hyperlink{a00003_aa57c86d3bbbeaf5c9d4f6bd00376b04f}{gbStatusPacket}[PRT1\_PKT\_ERRBIT] & (\textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char})error )
00273         \textcolor{keywordflow}{return} \textcolor{keyword}{true};
00274 
00275     \textcolor{keywordflow}{return} \textcolor{keyword}{false};
00276 \}
00277 
\hypertarget{a00012_source_l00278}{}\hyperlink{a00003_a6e62341ef9f51b6e152e769bd7be9d75}{00278} \textcolor{keywordtype}{int} \hyperlink{a00003_a6e62341ef9f51b6e152e769bd7be9d75}{dynamixel::get\_rxpacket\_error\_byte}(\textcolor{keywordtype}{void})
00279 \{
00280     \textcolor{keywordflow}{return} \hyperlink{a00003_aa57c86d3bbbeaf5c9d4f6bd00376b04f}{gbStatusPacket}[PRT1\_PKT\_ERRBIT];
00281 \}
00282 
\hypertarget{a00012_source_l00283}{}\hyperlink{a00003_a68b5fa99719a9aec0734ecfb0635503b}{00283} \textcolor{keywordtype}{int}  \hyperlink{a00003_a68b5fa99719a9aec0734ecfb0635503b}{dynamixel::get\_rxpacket\_parameter}( \textcolor{keywordtype}{int} index )
00284 \{
00285     \textcolor{keywordflow}{return} (\textcolor{keywordtype}{int})\hyperlink{a00003_aa57c86d3bbbeaf5c9d4f6bd00376b04f}{gbStatusPacket}[PRT1\_PKT\_PARAMETER0+index];
00286 \}
00287 
\hypertarget{a00012_source_l00288}{}\hyperlink{a00003_ae9cc18fdeda8329f68fa0f2f0a7a9aba}{00288} \textcolor{keywordtype}{int}  \hyperlink{a00003_ae9cc18fdeda8329f68fa0f2f0a7a9aba}{dynamixel::get\_rxpacket\_length}()
00289 \{
00290     \textcolor{keywordflow}{return} (\textcolor{keywordtype}{int})\hyperlink{a00003_aa57c86d3bbbeaf5c9d4f6bd00376b04f}{gbStatusPacket}[PRT1\_PKT\_LENGTH];
00291 \}
00292 
\hypertarget{a00012_source_l00293}{}\hyperlink{a00003_af2bd714423e7c4fc089762805c0c71f3}{00293} \textcolor{keywordtype}{void} \hyperlink{a00003_af2bd714423e7c4fc089762805c0c71f3}{dynamixel::ping}( \textcolor{keywordtype}{int} \textcolor{keywordtype}{id} )
00294 \{
00295     \textcolor{keywordflow}{while}(\hyperlink{a00003_ad10e0e49f5fef04bf789a89c14cc470a}{giBusUsing});
00296 
00297     \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_ID] = (\textcolor{keywordtype}{unsigned} char)\textcolor{keywordtype}{id};
00298     \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_INSTRUCTION] = INST\_PING;
00299     \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_LENGTH] = 2;
00300     
00301     \hyperlink{a00003_aebfc569c6b1eb0b98f8c385f0f921fc0}{txrx\_packet}();
00302 \}
00303 
\hypertarget{a00012_source_l00304}{}\hyperlink{a00003_a888404b41c4c4395a0b745c77ff2cea9}{00304} \textcolor{keywordtype}{int} \hyperlink{a00003_a888404b41c4c4395a0b745c77ff2cea9}{dynamixel::read\_byte}( \textcolor{keywordtype}{int} \textcolor{keywordtype}{id}, \textcolor{keywordtype}{int} address )
00305 \{
00306     \textcolor{keywordflow}{while}(\hyperlink{a00003_ad10e0e49f5fef04bf789a89c14cc470a}{giBusUsing});
00307 
00308     \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_ID] = (\textcolor{keywordtype}{unsigned} char)\textcolor{keywordtype}{id};
00309     \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_INSTRUCTION] = INST\_READ;
00310     \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_PARAMETER0+0] = (\textcolor{keywordtype}{unsigned} char)address;
00311     \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_PARAMETER0+1] = 1;
00312     \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_LENGTH] = 4;
00313     
00314     \hyperlink{a00003_aebfc569c6b1eb0b98f8c385f0f921fc0}{txrx\_packet}();
00315 
00316     \textcolor{keywordflow}{return} (\textcolor{keywordtype}{int})\hyperlink{a00003_aa57c86d3bbbeaf5c9d4f6bd00376b04f}{gbStatusPacket}[PRT1\_PKT\_PARAMETER0];
00317 \}
00318 
\hypertarget{a00012_source_l00319}{}\hyperlink{a00003_a66c1e32cc45dd46d329f1fc212e46a3d}{00319} \textcolor{keywordtype}{void} \hyperlink{a00003_a66c1e32cc45dd46d329f1fc212e46a3d}{dynamixel::write\_byte}( \textcolor{keywordtype}{int} \textcolor{keywordtype}{id}, \textcolor{keywordtype}{int} address, \textcolor{keywordtype}{int} value )
00320 \{
00321     \textcolor{keywordflow}{while}(\hyperlink{a00003_ad10e0e49f5fef04bf789a89c14cc470a}{giBusUsing});
00322 
00323     \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_ID] = (\textcolor{keywordtype}{unsigned} char)\textcolor{keywordtype}{id};
00324     \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_INSTRUCTION] = INST\_WRITE;
00325     \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_PARAMETER0+0] = (\textcolor{keywordtype}{unsigned} char)address;
00326     \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_PARAMETER0+1] = (\textcolor{keywordtype}{unsigned} char)value;
00327     \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_LENGTH] = 4;
00328     
00329     \hyperlink{a00003_aebfc569c6b1eb0b98f8c385f0f921fc0}{txrx\_packet}();
00330 \}
00331 
\hypertarget{a00012_source_l00332}{}\hyperlink{a00003_a45e99341e82c5114f6e829c9141bf96f}{00332} \textcolor{keywordtype}{int} \hyperlink{a00003_a45e99341e82c5114f6e829c9141bf96f}{dynamixel::read\_word}( \textcolor{keywordtype}{int} \textcolor{keywordtype}{id}, \textcolor{keywordtype}{int} address )
00333 \{
00334     \textcolor{keywordflow}{while}(\hyperlink{a00003_ad10e0e49f5fef04bf789a89c14cc470a}{giBusUsing});
00335 
00336     \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_ID] = (\textcolor{keywordtype}{unsigned} char)\textcolor{keywordtype}{id};
00337     \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_INSTRUCTION] = INST\_READ;
00338     \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_PARAMETER0+0] = (\textcolor{keywordtype}{unsigned} char)address;
00339     \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_PARAMETER0+1] = 2;
00340     \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_LENGTH] = 4;
00341     
00342     \hyperlink{a00003_aebfc569c6b1eb0b98f8c385f0f921fc0}{txrx\_packet}();
00343 
00344     \textcolor{keywordflow}{return} MAKEWORD((\textcolor{keywordtype}{int})\hyperlink{a00003_aa57c86d3bbbeaf5c9d4f6bd00376b04f}{gbStatusPacket}[PRT1\_PKT\_PARAMETER0+0], (\textcolor{keywordtype}{int})
      \hyperlink{a00003_aa57c86d3bbbeaf5c9d4f6bd00376b04f}{gbStatusPacket}[PRT1\_PKT\_PARAMETER0+1]);
00345 \}
00346 
\hypertarget{a00012_source_l00347}{}\hyperlink{a00003_a925f62ce5e261e5ef4fe6dc46bdc7c63}{00347} \textcolor{keywordtype}{void} \hyperlink{a00003_a925f62ce5e261e5ef4fe6dc46bdc7c63}{dynamixel::write\_word}( \textcolor{keywordtype}{int} \textcolor{keywordtype}{id}, \textcolor{keywordtype}{int} address, \textcolor{keywordtype}{int} value )
00348 \{
00349     \textcolor{keywordflow}{while}(\hyperlink{a00003_ad10e0e49f5fef04bf789a89c14cc470a}{giBusUsing});
00350 
00351     \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_ID] = (\textcolor{keywordtype}{unsigned} char)\textcolor{keywordtype}{id};
00352     \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_INSTRUCTION] = INST\_WRITE;
00353     \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_PARAMETER0+0] = (\textcolor{keywordtype}{unsigned} char)address;
00354     \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_PARAMETER0+1] = (\textcolor{keywordtype}{unsigned} char)LOBYTE(value);
00355     \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_PARAMETER0+2] = (\textcolor{keywordtype}{unsigned} char)HIBYTE(value);
00356     \hyperlink{a00003_afd94dcf01b8e96298727776e222de722}{gbInstructionPacket}[PRT1\_PKT\_LENGTH] = 5;
00357     
00358     \hyperlink{a00003_aebfc569c6b1eb0b98f8c385f0f921fc0}{txrx\_packet}();
00359 \}
\end{DoxyCode}
