\hypertarget{a00015_source}{}\section{mainwindow.\+cpp}

\begin{DoxyCode}
00001 \textcolor{preprocessor}{#include "\hyperlink{a00016}{mainwindow.h}"}
00003 \textcolor{preprocessor}{#include "ui\_mainwindow.h"}
00004 
\hypertarget{a00015_source_l00005}{}\hyperlink{a00004_a8b244be8b7b7db1b08de2a2acb9409db}{00005} \hyperlink{a00004_a8b244be8b7b7db1b08de2a2acb9409db}{MainWindow::MainWindow}(QWidget *parent) :
00006     QMainWindow(parent),
00007     \_axis(XJoystick::AxisCount),
00008     \_axisV(XJoystick::AxisCount),
00009     \_buts(XJoystick::ButtonCount),
00010     \_butsV(XJoystick::ButtonCount),
00011     ui(new \hyperlink{a00023}{Ui}::\hyperlink{a00004}{MainWindow})
00012 \{
00013     \hyperlink{a00004_a35466a70ed47252a0191168126a352a5}{ui}->setupUi(\textcolor{keyword}{this});
00014     
00015     \hyperlink{a00004_a97f8ecc7ecb930b796178cef7b975013}{\_sT}.start();
00016     
00017     connect(&\hyperlink{a00004_a671f35800890e518713e1946671d8730}{\_joy}, SIGNAL(changed()), \textcolor{keyword}{this}, SLOT(\hyperlink{a00004_abb4c2d8a79c9f80010ea031366bf8226}{joyChanged}()));
00018     connect(&\hyperlink{a00004_a254b03b878cfda75c1c411a2f8568d33}{\_timer}, SIGNAL(timeout()), \textcolor{keyword}{this}, SLOT(\hyperlink{a00004_a128f71880d4b9683149023fc46fcc9f8}{update}()));
00019     connect(&\hyperlink{a00004_a97f8ecc7ecb930b796178cef7b975013}{\_sT}, SIGNAL(statusBar(QString)), 
00020             \hyperlink{a00004_a35466a70ed47252a0191168126a352a5}{ui}->statusbar, SLOT(showMessage(QString)));
00021     
00022     
00023     \hyperlink{a00004_a254b03b878cfda75c1c411a2f8568d33}{\_timer}.setInterval(10);
00024     \hyperlink{a00004_a254b03b878cfda75c1c411a2f8568d33}{\_timer}.start();
00025     
00026     \textcolor{comment}{// JOYSTICK}
00027     QVector< QString > V(\hyperlink{a00004_a671f35800890e518713e1946671d8730}{\_joy}.getAllAxis());
00028     \textcolor{comment}{// Adding axis}
00029     QGridLayout *wL = \textcolor{keyword}{new} QGridLayout;
00030     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < XJoystick::AxisCount; ++i) \{
00031         QHBoxLayout *L = \textcolor{keyword}{new} QHBoxLayout;
00032         L->addWidget(\textcolor{keyword}{new} QLabel(V[i].append(\textcolor{stringliteral}{":"}), \textcolor{keyword}{this}));
00033         \hyperlink{a00004_a30c99d7a544f74b0650758e5cc7ead5a}{\_axis}[i] = \textcolor{keyword}{new} QLabel(\textcolor{stringliteral}{"#"});
00034         L->addWidget(\hyperlink{a00004_a30c99d7a544f74b0650758e5cc7ead5a}{\_axis}[i]);
00035         L->addStretch();
00036         wL->addLayout(L, i%3, i/3); 
00037     \}
00038     \hyperlink{a00004_a35466a70ed47252a0191168126a352a5}{ui}->joyAxis->setLayout(wL);
00039     
00040     \textcolor{comment}{// Adding buttons}
00041     wL = \textcolor{keyword}{new} QGridLayout;
00042     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < XJoystick::ButtonCount; ++i) \{
00043         \hyperlink{a00004_a8eaf474e1b8672f32873ed009e28ce8a}{\_buts}[i] = \textcolor{keyword}{new} QLabel(QString::number(i + 1));
00044         wL->addWidget(\hyperlink{a00004_a8eaf474e1b8672f32873ed009e28ce8a}{\_buts}[i], i/8, i%8);
00045         \hyperlink{a00004_a8eaf474e1b8672f32873ed009e28ce8a}{\_buts}[i]->setEnabled(\textcolor{keyword}{false});
00046         \hyperlink{a00004_a8eaf474e1b8672f32873ed009e28ce8a}{\_buts}[i]->hide();
00047     \}
00048     \hyperlink{a00004_a35466a70ed47252a0191168126a352a5}{ui}->joyButs->setLayout(wL);
00049     \hyperlink{a00004_a35466a70ed47252a0191168126a352a5}{ui}->joyAxis->hide();
00050     \hyperlink{a00004_a35466a70ed47252a0191168126a352a5}{ui}->joyButs->hide();
00051     \hyperlink{a00004_a35466a70ed47252a0191168126a352a5}{ui}->line->hide();
00052     
00053     
00054     \textcolor{comment}{// Creating data Path    }
00055     \hyperlink{a00004_aaccbe653019df03668429890e325ac21}{\_dataP} = QStandardPaths::writableLocation(QStandardPaths::AppDataLocation);
00056     QDir dir(\hyperlink{a00004_aaccbe653019df03668429890e325ac21}{\_dataP});
00057     \textcolor{keywordflow}{if} (!dir.exists()) dir.mkpath(\hyperlink{a00004_aaccbe653019df03668429890e325ac21}{\_dataP});
00058 \}
00059 
\hypertarget{a00015_source_l00060}{}\hyperlink{a00004_ae98d00a93bc118200eeef9f9bba1dba7}{00060} \hyperlink{a00004_ae98d00a93bc118200eeef9f9bba1dba7}{MainWindow::~MainWindow}()
00061 \{
00062     \textcolor{keyword}{delete} \hyperlink{a00004_a35466a70ed47252a0191168126a352a5}{ui};
00063 \}
00064 
\hypertarget{a00015_source_l00065}{}\hyperlink{a00004_abb4c2d8a79c9f80010ea031366bf8226}{00065} \textcolor{keywordtype}{void} \hyperlink{a00004_abb4c2d8a79c9f80010ea031366bf8226}{MainWindow::joyChanged}()
00066 \{
00067     \textcolor{keywordtype}{int} sel = \hyperlink{a00004_a671f35800890e518713e1946671d8730}{\_joy}.current();
00068     
00069     QVector< XJoystick::Info > V(\hyperlink{a00004_a671f35800890e518713e1946671d8730}{\_joy}.available());
00070     \textcolor{keywordtype}{bool} found = \textcolor{keyword}{false};
00071     \textcolor{keywordtype}{int} i = 0;
00072     \textcolor{keywordflow}{while} (i < V.size() and not found) \{ found = V[i].ID == sel; ++i; \}
00073     \textcolor{keywordflow}{if} (not found) \{
00074         \textcolor{keywordflow}{if} (V.size() > 0) \{
00075             \hyperlink{a00004_a671f35800890e518713e1946671d8730}{\_joy}.select(V[0].ID);
00076             \hyperlink{a00004_a35466a70ed47252a0191168126a352a5}{ui}->line->hide();
00077             
00078             \textcolor{comment}{// Showing axis}
00079             \hyperlink{a00004_a35466a70ed47252a0191168126a352a5}{ui}->joyAxis->show();
00080             
00081             \textcolor{comment}{// Showing buttons}
00082             \textcolor{keywordflow}{for} (QLabel *l : \hyperlink{a00004_a8eaf474e1b8672f32873ed009e28ce8a}{\_buts}) l->hide();
00083             \hyperlink{a00004_a35466a70ed47252a0191168126a352a5}{ui}->joyButs->show();
00084             \textcolor{keywordtype}{int} n = \hyperlink{a00004_a671f35800890e518713e1946671d8730}{\_joy}.buttonCount();
00085             \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < n; ++i) \_buts[i]->show();
00086         \}
00087         \textcolor{keywordflow}{else} \{
00088             \hyperlink{a00004_a671f35800890e518713e1946671d8730}{\_joy}.select(-1);
00089             \hyperlink{a00004_a35466a70ed47252a0191168126a352a5}{ui}->joyAxis->hide();
00090             \hyperlink{a00004_a35466a70ed47252a0191168126a352a5}{ui}->joyButs->hide();
00091             \hyperlink{a00004_a35466a70ed47252a0191168126a352a5}{ui}->line->hide();
00092         \}
00093     \}
00094     emit \hyperlink{a00004_ac85ba5aec3be2a51a348ff669b9dc842}{joystickChanged}();
00095 \}
00096 
00097 
\hypertarget{a00015_source_l00098}{}\hyperlink{a00004_a1dd57ccb62bc6f5a361aba6e088dd2e1}{00098} \textcolor{keywordtype}{void} \hyperlink{a00004_a1dd57ccb62bc6f5a361aba6e088dd2e1}{MainWindow::on\_actionOptions\_triggered}()
00099 \{
00100     \hyperlink{a00005}{OptionsWindow} o(\hyperlink{a00004_a671f35800890e518713e1946671d8730}{\_joy}, &\hyperlink{a00004_a97f8ecc7ecb930b796178cef7b975013}{\_sT}, \hyperlink{a00004_a282d4090e96c676578c4336391b1af08}{\_jAxisX}, \hyperlink{a00004_aaaced09ce813bbcac92047f5ef39f182}{\_jAxisY}, 
      \hyperlink{a00004_a18cc17eff4ff04ee0aae07c609e82d33}{\_jAxisZ}, \textcolor{keyword}{this});
00101     o.exec();
00102     
00103     connect(\textcolor{keyword}{this}, SIGNAL(\hyperlink{a00004_ac85ba5aec3be2a51a348ff669b9dc842}{joystickChanged}()), &o, SLOT(
      \hyperlink{a00004_ac85ba5aec3be2a51a348ff669b9dc842}{joystickChanged}()));
00104     
00105     \textcolor{keywordflow}{if} (o.result()) o.\hyperlink{a00005_ab0a56ad7347c20046602a7a2a1c83397}{storeData}();
00106 \}
00107 
\hypertarget{a00015_source_l00108}{}\hyperlink{a00004_a128f71880d4b9683149023fc46fcc9f8}{00108} \textcolor{keywordtype}{void} \hyperlink{a00004_a128f71880d4b9683149023fc46fcc9f8}{MainWindow::update}()
00109 \{
00110     \hyperlink{a00004_a671f35800890e518713e1946671d8730}{\_joy}.update();
00111     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < XJoystick::AxisCount; ++i) \hyperlink{a00004_a20f66f574ed4c96d8dfc0013e1095f15}{\_axisV}[i] = \hyperlink{a00004_a671f35800890e518713e1946671d8730}{\_joy}[i];
00112     \textcolor{keywordflow}{for} (\textcolor{keywordtype}{int} i = 0; i < XJoystick::ButtonCount; ++i) \hyperlink{a00004_a519ae4630572cb63fbd04bce12fe8e77}{\_butsV}[i] = \hyperlink{a00004_a671f35800890e518713e1946671d8730}{\_joy}.button(i);
00113     
00114     \hyperlink{a00004_a97f8ecc7ecb930b796178cef7b975013}{\_sT}.\hyperlink{a00007_a8497ea56991b620981ce1fbf53d9ebdb}{setData}(\hyperlink{a00004_a20f66f574ed4c96d8dfc0013e1095f15}{\_axisV}, \hyperlink{a00004_a519ae4630572cb63fbd04bce12fe8e77}{\_butsV});
00115     QVector<ServoThread::Servo> servo(\hyperlink{a00004_a97f8ecc7ecb930b796178cef7b975013}{\_sT}.\hyperlink{a00007_a5fd8ef13314428f5ba7646730cc58f1c}{getServosInfo}());
00116     
00117     \textcolor{comment}{// TODO: Finish update function}
00118 \}
00119 
\hypertarget{a00015_source_l00120}{}\hyperlink{a00004_ae66e9ab15f911b93fce0f161d2fde880}{00120} \textcolor{keywordtype}{void} \hyperlink{a00004_ae66e9ab15f911b93fce0f161d2fde880}{MainWindow::on\_start\_clicked}()
00121 \{
00122     QString text = \hyperlink{a00004_a35466a70ed47252a0191168126a352a5}{ui}->start->text();
00123     
00124     \textcolor{keywordflow}{if} (text == \textcolor{stringliteral}{"Start"}) \{
00125         \hyperlink{a00004_a97f8ecc7ecb930b796178cef7b975013}{\_sT}.\hyperlink{a00007_a5f32574f843d76deffec45995028389b}{wakeUp}();
00126         \hyperlink{a00004_a35466a70ed47252a0191168126a352a5}{ui}->start->setText(\textcolor{stringliteral}{"Stop"});
00127     \}
00128     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (text == \textcolor{stringliteral}{"Stop"}) \{
00129         \hyperlink{a00004_a97f8ecc7ecb930b796178cef7b975013}{\_sT}.\hyperlink{a00007_ae0d4a59954aafbe8cd85f9326e4fcdd0}{pause}();
00130         \hyperlink{a00004_a35466a70ed47252a0191168126a352a5}{ui}->start->setText(\textcolor{stringliteral}{"Start"});
00131     \}
00132 \}
\end{DoxyCode}
